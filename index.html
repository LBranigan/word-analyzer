<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Word Analyzer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-title">
                <h1>Word Analyzer</h1>
                <p class="subtitle">Morningside Academy</p>
            </div>
            <div class="word-count-header">
                <span id="word-count">0</span> words
            </div>
        </header>

        <!-- Breadcrumb Navigation -->
        <nav id="breadcrumb-nav" class="breadcrumb-nav">
            <div class="breadcrumb-container">
                <div class="breadcrumb-step" data-step="setup">
                    <span class="step-icon">‚úì</span>
                    <span class="step-label">Setup</span>
                </div>
                <span class="breadcrumb-arrow">‚Üí</span>
                <div class="breadcrumb-step" data-step="capture">
                    <span class="step-icon">1</span>
                    <span class="step-label">Capture Image</span>
                </div>
                <span class="breadcrumb-arrow">‚Üí</span>
                <div class="breadcrumb-step" data-step="audio">
                    <span class="step-icon">2</span>
                    <span class="step-label">Record Audio</span>
                </div>
                <span class="breadcrumb-arrow">‚Üí</span>
                <div class="breadcrumb-step" data-step="highlight">
                    <span class="step-icon">3</span>
                    <span class="step-label">Highlight Text</span>
                </div>
                <span class="breadcrumb-arrow">‚Üí</span>
                <div class="breadcrumb-step" data-step="results">
                    <span class="step-icon">4</span>
                    <span class="step-label">Results</span>
                </div>
            </div>
        </nav>

        <main>
            <!-- Audio Playback Section (Legacy - hidden by default, audio now in dedicated section) -->
            <section id="audio-playback-section" class="audio-playback-container" style="display: none;">
                <h3>Recorded Audio</h3>
                <audio id="audio-player" controls></audio>
                <div class="audio-actions">
                    <button id="download-audio-btn-legacy" class="btn btn-secondary">
                        <span class="icon">üíæ</span> Download Audio
                    </button>
                    <button id="analyze-audio-btn-legacy" class="btn btn-primary">
                        <span class="icon">üîç</span> Analyze Audio
                    </button>
                </div>
            </section>

            <!-- API Key Setup Section -->
            <section id="setup-section" class="section active">
                <div class="setup-container">
                    <h2>Setup Required</h2>
                    <p class="setup-description">
                        This app uses Google Cloud Vision API for highly accurate word detection (99%+ accuracy).
                    </p>
                    <div class="setup-steps">
                        <h3>Quick Setup (2 minutes):</h3>
                        <ol>
                            <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a></li>
                            <li>Create a new API key</li>
                            <li>Enable "Cloud Vision API" (for text recognition)</li>
                            <li>Enable "Cloud Speech-to-Text API" (for audio analysis)</li>
                            <li>Paste your API key below</li>
                        </ol>
                        <p class="note">Free tier: 1,000 Vision requests + 60 minutes Speech/month</p>
                    </div>
                    <div class="api-key-input">
                        <input type="password" id="api-key" placeholder="Enter your Google Cloud Vision API key" />
                        <button id="save-api-key-btn" class="btn btn-primary">Save & Start</button>
                    </div>
                    <p class="privacy-note">Your API key is stored locally in your browser only.</p>
                </div>
            </section>

            <!-- Camera Section -->
            <section id="camera-section" class="section">
                <div class="step-header">
                    <div class="step-badge">Step 1</div>
                    <h2>Capture Image</h2>
                    <p class="step-subtitle">First, let's capture the text that will be read</p>
                </div>

                <div class="camera-container">
                    <video id="camera" autoplay playsinline></video>
                    <canvas id="camera-canvas" style="display: none;"></canvas>
                </div>
                <div class="controls">
                    <button id="capture-btn" class="btn btn-primary">
                        <span class="icon">üì∑</span> Capture Photo
                    </button>
                    <button id="upload-btn-camera" class="btn btn-secondary">
                        <span class="icon">üìÅ</span> Upload Photo
                    </button>
                </div>

                <div class="instructions-box">
                    <h4>üí° Quick Guide:</h4>
                    <ol class="instructions-list">
                        <li>Take a clear photo of the text to be read</li>
                        <li>Make sure the text is well-lit and in focus</li>
                        <li>The image will be processed for word detection</li>
                    </ol>
                </div>

                <input type="file" id="file-input-camera" accept="image/*" style="display: none;">
            </section>

            <!-- Audio Recording Section -->
            <section id="audio-section" class="section">
                <div class="step-header">
                    <div class="step-badge">Step 2</div>
                    <h2>Record Audio</h2>
                    <p class="step-subtitle">Record the student reading the text</p>
                </div>

                <div class="audio-recording-container">
                    <div class="image-preview">
                        <div class="preview-header">
                            <h4>üìÑ Captured Text Preview</h4>
                            <button id="toggle-preview-size-btn" class="btn btn-secondary btn-sm">
                                <span class="icon">üîç</span> <span id="toggle-preview-text">Expand</span>
                            </button>
                        </div>
                        <canvas id="mini-preview-canvas"></canvas>
                    </div>

                    <div class="audio-controls-center">
                        <button id="record-audio-btn" class="btn btn-audio btn-large">
                            <span class="icon">üé§</span> Record Audio
                        </button>
                    </div>

                    <div id="audio-player-section" class="audio-player-section" style="display: none;">
                        <h4>‚úÖ Recording Complete</h4>
                        <audio id="audio-player-main" controls></audio>
                        <div class="audio-actions-inline">
                            <button id="download-audio-btn-main" class="btn btn-secondary">
                                <span class="icon">üíæ</span> Download
                            </button>
                            <button id="rerecord-audio-btn" class="btn btn-secondary">
                                <span class="icon">üîÑ</span> Re-record
                            </button>
                        </div>
                    </div>
                </div>

                <div class="step-navigation">
                    <button id="back-to-capture-btn" class="btn btn-secondary">
                        <span class="icon">‚Üê</span> Back to Capture
                    </button>
                    <button id="next-to-highlight-btn" class="btn btn-primary" disabled>
                        Next: Highlight Text <span class="icon">‚Üí</span>
                    </button>
                </div>

                <div class="instructions-box">
                    <h4>üí° Recording Tips:</h4>
                    <ul class="instructions-list">
                        <li>Choose recording duration (1-5 minutes)</li>
                        <li>Make sure the microphone is working</li>
                        <li>Record in a quiet environment for best results</li>
                    </ul>
                </div>
            </section>

            <!-- Image Processing Section -->
            <section id="image-section" class="section">
                <div class="step-header">
                    <div class="step-badge">Step 3</div>
                    <h2>Highlight Text</h2>
                    <p class="step-subtitle">Select the words that were read aloud</p>
                </div>

                <div class="highlight-instructions">
                    <p><strong>üñ±Ô∏è How to select:</strong> Click any word to select/deselect ‚Ä¢ Drag to select multiple words ‚Ä¢ Right-click to pan image</p>
                </div>

                <div class="image-wrapper">
                    <div class="image-container">
                        <canvas id="selection-canvas"></canvas>
                    </div>
                    <div class="zoom-controls">
                        <button id="zoom-in-btn" class="zoom-btn" title="Zoom In">+</button>
                        <button id="zoom-out-btn" class="zoom-btn" title="Zoom Out">‚àí</button>
                        <button id="zoom-reset-btn" class="zoom-btn" title="Reset View">‚ü≤</button>
                    </div>
                </div>

                <div class="controls">
                    <button id="reset-selection-btn" class="btn btn-secondary">
                        <span class="icon">‚úñÔ∏è</span> Clear Selection
                    </button>
                </div>

                <input type="file" id="file-input-image" accept="image/*" style="display: none;">
                <div id="status" class="status"></div>

                <div class="step-navigation">
                    <button id="back-to-audio-btn" class="btn btn-secondary">
                        <span class="icon">‚Üê</span> Back to Audio
                    </button>
                    <button id="analyze-audio-btn" class="btn btn-primary btn-large" disabled>
                        <span class="icon">üîç</span> Analyze Reading
                    </button>
                </div>

                <div class="export-section">
                    <button id="export-btn" class="btn btn-export">
                        <span class="icon">üìã</span> Export Selected Words
                    </button>
                    <div id="export-output" class="export-output"></div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="section">
                <div class="step-header">
                    <div class="step-badge">‚úì</div>
                    <h2>Analysis Results</h2>
                    <p class="step-subtitle">Reading Comprehension Report</p>
                </div>

                <div class="results-actions">
                    <button id="back-to-edit-btn" class="btn btn-secondary">
                        <span class="icon">‚Üê</span> Back to Edit
                    </button>
                    <button id="start-new-analysis-btn" class="btn btn-secondary">
                        <span class="icon">üîÑ</span> Start New Analysis
                    </button>
                </div>

                <div id="results-container" class="results-container">
                    <!-- Results will be dynamically inserted here -->
                </div>
            </section>
        </main>

        <footer>
            <p class="hint">üëÜ Left-click: drag to select words ‚Ä¢ Right-click: drag to pan image ‚Ä¢ Click yellow words to deselect</p>
            <p class="version">Version: 2025-01-22 (Guided UX)</p>
        </footer>
    </div>

    <!-- Audio Recording Modal -->
    <div id="audio-modal" class="modal">
        <div class="modal-content">
            <h2>Record Audio</h2>
            <p>How many minutes would you like to record?</p>
            <div class="duration-input">
                <input type="number" id="audio-duration" min="1" max="5" value="1" />
                <span>minutes (max 5)</span>
            </div>
            <div class="modal-buttons">
                <button id="start-recording-btn" class="btn btn-primary">Start Recording</button>
                <button id="cancel-recording-btn" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Recording Status -->
    <div id="recording-modal" class="recording-indicator">
        <div class="recording-indicator-content">
            <div class="recording-header">
                <span class="recording-icon">üé§</span>
                <span class="recording-label">Recording</span>
            </div>
            <div class="recording-timer" id="recording-timer">00:00</div>
            <div class="recording-progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <button id="stop-recording-btn" class="btn btn-danger btn-stop-compact">Stop</button>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div id="image-preview-modal" class="image-preview-modal">
        <div class="image-preview-close-hint">Click image to close</div>
        <img id="image-preview-img" src="" alt="Full size preview">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
